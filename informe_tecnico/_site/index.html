<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.31">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Aplicaciones en Sistemas de Recomendación e Imágenes</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-e1a5c8363afafaef2c763b6775fbf3ca.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-991b1886d3c685c7aa2b62b80640c7af.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


</head>

<body class="nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Aplicaciones en Sistemas de Recomendación e Imágenes</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link active" href="./index.html" aria-current="page"> 
<span class="menu-text">Inicio</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul class="collapse">
  <li><a href="#objetivos" id="toc-objetivos" class="nav-link active" data-scroll-target="#objetivos"><span class="header-section-number">1</span> Objetivos</a>
  <ul class="collapse">
  <li><a href="#objetivo-general" id="toc-objetivo-general" class="nav-link" data-scroll-target="#objetivo-general"><span class="header-section-number">1.1</span> Objetivo General</a></li>
  <li><a href="#objetivos-especificos" id="toc-objetivos-especificos" class="nav-link" data-scroll-target="#objetivos-especificos"><span class="header-section-number">1.2</span> Objetivos especificos</a></li>
  </ul></li>
  <li><a href="#desarrollo-técnico" id="toc-desarrollo-técnico" class="nav-link" data-scroll-target="#desarrollo-técnico"><span class="header-section-number">2</span> Desarrollo Técnico</a>
  <ul class="collapse">
  <li><a href="#punto-3" id="toc-punto-3" class="nav-link" data-scroll-target="#punto-3"><span class="header-section-number">2.1</span> Punto 3</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Introducción</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<div id="91f07e5b" class="cell" data-execution_count="1">
<div class="cell-output cell-output-display">

<style>
    h2 {
        border: none !important;
        box-shadow: none !important;
        border-bottom: none !important;
    }
</style>
<div style="
    background-color:rgb(255, 255, 255);
    border-radius: 15px;
    padding: 30px;
    text-align: center;
    font-family: Arial, sans-serif;
    color: #333;
    box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.2);">
    <h1 style="color:rgb(26, 54, 97); font-size: 50px;">Trabajo 3: aplicaciones en sistemas de recomendación e imágenes</h1>
    <h2 style="color: #555;" class="anchored">Redes Neuronales y Algoritmos Bioinspirados</h2>

    <h3 style="color: #222; margin: 10px 0;" class="anchored">Equipo:</h3>
    <ul style="list-style: none; padding: 0; font-size: 20px;">
        <li>Juan José Correa Hurtado</li>
        <li>Jacobo Ochoa Ramírez</li>
    </ul>
    <h3 style="color: #222; margin: 10px 0;" class="anchored">Profesor:</h3>
    <ul style="list-style: none; padding: 0; font-size: 20px;">
        <li>Juan David Ospina Arango</li>
    </ul>
    <h2 style="color: #555;" class="anchored">Universidad Nacional de Colombia</h2>
    <img src="imagenes/logo_UNAL.png" alt="logo UNAL">
</div>
</div>
</div>
<p>En el contexto actual, las empresas de transporte enfrentan desafíos crecientes relacionados con la eficiencia operativa, la seguridad vial y la satisfacción del usuario. Factores como la variabilidad en la demanda, los riesgos asociados a la conducción distractiva y la necesidad de ofrecer experiencias personalizadas exigen soluciones tecnológicas avanzadas. Este proyecto propone el desarrollo de un sistema inteligente integrado basado en técnicas de aprendizaje profundo, con el objetivo de abordar tres problemáticas clave: la predicción de la demanda de transporte mediante series de tiempo, la clasificación automática de comportamientos distractores en conductores a partir de imágenes, y la recomendación personalizada de destinos de viaje para los usuarios.</p>
<section id="objetivos" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Objetivos</h1>
<section id="objetivo-general" class="level2" data-number="1.1">
<h2 data-number="1.1" class="anchored" data-anchor-id="objetivo-general"><span class="header-section-number">1.1</span> Objetivo General</h2>
<p>Desarrollar un sistema inteligente integrado basado en aprendizaje profundo que permita predecir la demanda de transporte, clasificar comportamientos distractores en conductores a partir de imágenes y generar recomendaciones personalizadas de destinos de viaje, con el fin de optimizar la eficiencia operativa, mejorar la seguridad vial y elevar la experiencia del usuario en una empresa de transporte.</p>
</section>
<section id="objetivos-especificos" class="level2" data-number="1.2">
<h2 data-number="1.2" class="anchored" data-anchor-id="objetivos-especificos"><span class="header-section-number">1.2</span> Objetivos especificos</h2>
<ol type="1">
<li><strong>Desarrollar un modelo de series de tiempo</strong> que utilice datos históricos para predecir la demanda de transporte en rutas específicas durante los próximos 30 días, facilitando una mejor planificación de recursos.</li>
<li><strong>Entrenar un modelo de clasificación de imágenes</strong> para identificar comportamientos distractores en los conductores, como el uso del teléfono móvil o la somnolencia, con el fin de reducir riesgos de accidentes.</li>
<li><strong>Implementar un sistema de recomendación personalizado</strong> que sugiera destinos de viaje a los usuarios, utilizando información del historial de viajes y preferencias individuales.</li>
<li><strong>Diseñar una herramienta web interactiva</strong> que integre los tres módulos desarrollados, permitiendo la visualización de predicciones, la clasificación de imágenes y la generación de recomendaciones de manera accesible para los usuarios y administradores de la empresa.</li>
<li><strong>Documentar el proceso completo de desarrollo</strong> en un informe técnico.</li>
</ol>
</section>
</section>
<section id="desarrollo-técnico" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Desarrollo Técnico</h1>
<p>﻿## Punto 1 ### 1. Código del modelo con preprocesamiento de datos (por ejemplo, limpieza de datos, transformación de series de tiempo). Primero importamos la librerias utilizadas <code>python import os import json import zipfile import pandas as pd import matplotlib.pyplot as plt import seaborn as sns import numpy as np import kagglehub from sklearn.metrics import confusion_matrix, accuracy_score, roc_auc_score, roc_curve, classification_report from sklearn.model_selection import train_test_split import torch from torch import nn import torch.optim as optim from torch.utils.data import DataLoader, TensorDataset from sklearn.preprocessing import StandardScaler from sklearn.utils.class_weight import compute_class_weight from sklearn.metrics import mean_squared_error, mean_absolute_error from prophet import Prophet</code> Luego descargamos los csv al colab y los leemos con la librería pandas</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co">#ES NECESARIO SUBIR LOS CSV AL COLAB</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>path <span class="op">=</span> kagglehub.dataset_download(<span class="st">"amanmehra23/travel-recommendation-dataset"</span>)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Path to dataset files:"</span>, path)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>destinations_df <span class="op">=</span> pd.read_csv(<span class="st">"/kaggle/input/travel-recommendation-dataset/Expanded_Destinations.csv"</span>)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>reviews_df <span class="op">=</span> pd.read_csv(<span class="st">"/kaggle/input/travel-recommendation-dataset/Final_Updated_Expanded_Reviews.csv"</span>)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>userhistory_df <span class="op">=</span> pd.read_csv(<span class="st">"/kaggle/input/travel-recommendation-dataset/Final_Updated_Expanded_UserHistory.csv"</span>)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>users_df <span class="op">=</span> pd.read_csv(<span class="st">"/kaggle/input/travel-recommendation-dataset/Final_Updated_Expanded_Users.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>display(userhistory_df.head())</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>userhistory_df.info()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 999 entries, 0 to 998
Data columns (total 5 columns):
 #   Column            Non-Null Count  Dtype 
---  ------            --------------  ----- 
 0   HistoryID         999 non-null    int64 
 1   UserID            999 non-null    int64 
 2   DestinationID     999 non-null    int64 
 3   VisitDate         999 non-null    object
 4   ExperienceRating  999 non-null    int64 
dtypes: int64(4), object(1)
memory usage: 39.2+ KB</code></pre>
<div class="sourceCode" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Verificar valores únicos por columna</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Valores únicos por columna:"</span>)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(userhistory_df.nunique())</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Verificar valores nulos</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Valores nulos por columna:"</span>)</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(userhistory_df.isnull().<span class="bu">sum</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>Valores únicos por columna:
HistoryID           999
UserID              642
DestinationID       638
VisitDate             3
ExperienceRating      5
dtype: int64

Valores nulos por columna:
HistoryID           0
UserID              0
DestinationID       0
VisitDate           0
ExperienceRating    0
dtype: int64</code></pre>
<div class="sourceCode" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Combinar datasets</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>reviews_destinations <span class="op">=</span> pd.merge(reviews_df, destinations_df, on<span class="op">=</span><span class="st">'DestinationID'</span>, how<span class="op">=</span><span class="st">'inner'</span>)</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>reviews_destinations_userhistory <span class="op">=</span> pd.merge(reviews_destinations, userhistory_df, on<span class="op">=</span><span class="st">'UserID'</span>, how<span class="op">=</span><span class="st">'inner'</span>)</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.merge(reviews_destinations_userhistory, users_df, on<span class="op">=</span><span class="st">'UserID'</span>, how<span class="op">=</span><span class="st">'inner'</span>)</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>df.info()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 993 entries, 0 to 992
Data columns (total 20 columns):
 #   Column            Non-Null Count  Dtype  
---  ------            --------------  -----  
 0   ReviewID          993 non-null    int64  
 1   DestinationID_x   993 non-null    int64  
 2   UserID            993 non-null    int64  
 3   Rating            993 non-null    int64  
 4   ReviewText        993 non-null    object 
 5   Name_x            993 non-null    object 
 6   State             993 non-null    object 
 7   Type              993 non-null    object 
 8   Popularity        993 non-null    float64
 9   BestTimeToVisit   993 non-null    object 
 10  HistoryID         993 non-null    int64  
 11  DestinationID_y   993 non-null    int64  
 12  VisitDate         993 non-null    object 
 13  ExperienceRating  993 non-null    int64  
 14  Name_y            993 non-null    object 
 15  Email             993 non-null    object 
 16  Preferences       993 non-null    object 
 17  Gender            993 non-null    object 
 18  NumberOfAdults    993 non-null    int64  
 19  NumberOfChildren  993 non-null    int64  
dtypes: float64(1), int64(9), object(10)
memory usage: 155.3+ KB</code></pre>
<div class="sourceCode" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Revisión de datos nulos o duplicados</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>df.shape</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>df.duplicated().<span class="bu">sum</span>()</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>df.isnull().<span class="bu">sum</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Ahora que tenemos los csv combinados en un solo dataset podemos hacer una exploración inicial de los datos.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>))</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>sns.barplot(y<span class="op">=</span><span class="st">'Name'</span>, x<span class="op">=</span><span class="st">'Popularity'</span>, data<span class="op">=</span>destinations_df.sort_values(by<span class="op">=</span><span class="st">'Popularity'</span>, ascending<span class="op">=</span><span class="va">True</span>), palette<span class="op">=</span><span class="st">'coolwarm'</span>, hue<span class="op">=</span><span class="st">'Name'</span>)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Most Popular Destinations'</span>)</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Popularity Score'</span>)</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Destination'</span>)</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>De esta gráfica inicial podemos ver cuales destinos son los más populares, siendo los que tengan colores más cálidos los más populares. Ahora veamos información sobre las columnas del dataset.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Ver cuantos datos hay por cada usuario</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>userhistory_df.groupby(<span class="st">'UserID'</span>).size().sort_values(ascending<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Convertir la fecha a datetime name_x =&gt; ciudad name_y =&gt; nombre del usuario</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>df_copia <span class="op">=</span> df.copy()</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>df_copia[<span class="st">'VisitDate'</span>] <span class="op">=</span> pd.to_datetime(df_copia[<span class="st">'VisitDate'</span>], errors<span class="op">=</span><span class="st">'coerce'</span>)</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>df_copia.info()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 993 entries, 0 to 992
Data columns (total 20 columns):
 #   Column            Non-Null Count  Dtype         
---  ------            --------------  -----         
 0   ReviewID          993 non-null    int64         
 1   DestinationID_x   993 non-null    int64         
 2   UserID            993 non-null    int64         
 3   Rating            993 non-null    int64         
 4   ReviewText        993 non-null    object        
 5   Name_x            993 non-null    object        
 6   State             993 non-null    object        
 7   Type              993 non-null    object        
 8   Popularity        993 non-null    float64       
 9   BestTimeToVisit   993 non-null    object        
 10  HistoryID         993 non-null    int64         
 11  DestinationID_y   993 non-null    int64         
 12  VisitDate         993 non-null    datetime64[ns]
 13  ExperienceRating  993 non-null    int64         
 14  Name_y            993 non-null    object        
 15  Email             993 non-null    object        
 16  Preferences       993 non-null    object        
 17  Gender            993 non-null    object        
 18  NumberOfAdults    993 non-null    int64         
 19  NumberOfChildren  993 non-null    int64         
dtypes: datetime64[ns](1), float64(1), int64(9), object(9)
memory usage: 155.3+ KB</code></pre>
<p>Ahora, para ver cual es el destino más visitado se crea la serie de tiempo agregada a partir del dataset.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Crear la serie de tiempo agregada: Agrupar por día y destino para contar número de viajes</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>df_demand <span class="op">=</span> df_copia.groupby([<span class="st">'VisitDate'</span>, <span class="st">'Name_x'</span>]).size().reset_index(name<span class="op">=</span><span class="st">'num_viajes'</span>)</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Ordenar por fecha</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>df_demand <span class="op">=</span> df_demand.sort_values(<span class="st">'VisitDate'</span>)</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Ver los destinos más populares</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>top_destinos <span class="op">=</span> df_demand.groupby(<span class="st">'Name_x'</span>)[<span class="st">'num_viajes'</span>].<span class="bu">sum</span>().sort_values(ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Destinos más visitados:"</span>)</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(top_destinos.head(<span class="dv">10</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>Destinos más visitados:
Name_x
Leh Ladakh           222
Taj Mahal            206
Jaipur City          201
Kerala Backwaters    192
Goa Beaches          172
Name: num_viajes, dtype: int64</code></pre>
<p>Pasamos a hacer la serie de tiempo del destino más visitado para hacer una primera modelación.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Seleccionar la ciudad más visitada</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>ciudad_top <span class="op">=</span> df_demand.groupby(<span class="st">'Name_x'</span>)[<span class="st">'num_viajes'</span>].<span class="bu">sum</span>().sort_values(ascending<span class="op">=</span><span class="va">False</span>).index[<span class="dv">0</span>]</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Filtrar solo esa ciudad</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>df_ciudad <span class="op">=</span> df_demand[df_demand[<span class="st">'Name_x'</span>] <span class="op">==</span> ciudad_top].copy()</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Renombrar columnas como lo requiere Prophet</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>df_ciudad <span class="op">=</span> df_ciudad.rename(columns<span class="op">=</span>{<span class="st">'VisitDate'</span>: <span class="st">'ds'</span>, <span class="st">'num_viajes'</span>: <span class="st">'y'</span>})</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Asegurarnos de que estén ordenadas por fecha</span></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>df_ciudad <span class="op">=</span> df_ciudad.sort_values(<span class="st">'ds'</span>)</span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Mostrar datos</span></span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Serie de tiempo para la ciudad: </span><span class="sc">{</span>ciudad_top<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>display(df_ciudad)</span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Crear el modelo</span></span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a>modelo <span class="op">=</span> Prophet(daily_seasonality<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Entrenar el modelo</span></span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a>modelo.fit(df_ciudad)</span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Crear un dataframe para predicción de los próximos 30 días</span></span>
<span id="cb15-25"><a href="#cb15-25" aria-hidden="true" tabindex="-1"></a>future <span class="op">=</span> modelo.make_future_dataframe(periods<span class="op">=</span><span class="dv">30</span>)</span>
<span id="cb15-26"><a href="#cb15-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-27"><a href="#cb15-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Predecir</span></span>
<span id="cb15-28"><a href="#cb15-28" aria-hidden="true" tabindex="-1"></a>forecast <span class="op">=</span> modelo.predict(future)</span>
<span id="cb15-29"><a href="#cb15-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-30"><a href="#cb15-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Graficar los resultados</span></span>
<span id="cb15-31"><a href="#cb15-31" aria-hidden="true" tabindex="-1"></a>modelo.plot(forecast)</span>
<span id="cb15-32"><a href="#cb15-32" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="ss">f"Predicción de demanda para </span><span class="sc">{</span>ciudad_top<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb15-33"><a href="#cb15-33" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Fecha"</span>)</span>
<span id="cb15-34"><a href="#cb15-34" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Número de viajes"</span>)</span>
<span id="cb15-35"><a href="#cb15-35" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Ahora veamos las predicciones para todas las ciudades</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Unir todos los forecast en un solo DataFrame</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>df_predicciones_total <span class="op">=</span> pd.concat(predicciones_por_ciudad.values())</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Filtrar solo las fechas futuras (los 30 días siguientes)</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>ultima_fecha_real <span class="op">=</span> df_demand[<span class="st">'VisitDate'</span>].<span class="bu">max</span>()</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>df_futuro <span class="op">=</span> df_predicciones_total[df_predicciones_total[<span class="st">'ds'</span>] <span class="op">&gt;</span> ultima_fecha_real]</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Gráfico combinado</span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">6</span>))</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> ciudad <span class="kw">in</span> top_5_ciudades:</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>    datos <span class="op">=</span> df_futuro[df_futuro[<span class="st">'ciudad'</span>] <span class="op">==</span> ciudad]</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>    plt.plot(datos[<span class="st">'ds'</span>], datos[<span class="st">'yhat'</span>], label<span class="op">=</span>ciudad)</span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Proyección de demanda para los próximos 30 días"</span>)</span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Fecha"</span>)</span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Número de viajes"</span>)</span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="va">True</span>)</span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<section id="métricas-de-evaluación" class="level3" data-number="2.0.1">
<h3 data-number="2.0.1" class="anchored" data-anchor-id="métricas-de-evaluación"><span class="header-section-number">2.0.1</span> 2. Métricas de evaluación</h3>
<div class="sourceCode" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Métricas de evaluación (RMSE, MAE)</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Métricas de evaluación:</span><span class="ch">\n</span><span class="st">"</span>)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> ciudad <span class="kw">in</span> top_5_ciudades:</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>    df_real <span class="op">=</span> df_demand[df_demand[<span class="st">'Name_x'</span>] <span class="op">==</span> ciudad][[<span class="st">'VisitDate'</span>, <span class="st">'num_viajes'</span>]].copy()</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>    df_real <span class="op">=</span> df_real.rename(columns<span class="op">=</span>{<span class="st">'VisitDate'</span>: <span class="st">'ds'</span>, <span class="st">'num_viajes'</span>: <span class="st">'y'</span>}).sort_values(<span class="st">'ds'</span>)</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>    forecast <span class="op">=</span> predicciones_por_ciudad[ciudad]</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>    forecast_real <span class="op">=</span> forecast.merge(df_real, on<span class="op">=</span><span class="st">'ds'</span>, how<span class="op">=</span><span class="st">'inner'</span>)  <span class="co"># Solo fechas reales</span></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>    rmse <span class="op">=</span> np.sqrt(mean_squared_error(forecast_real[<span class="st">'y'</span>], forecast_real[<span class="st">'yhat'</span>]))</span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>    mae <span class="op">=</span> mean_absolute_error(forecast_real[<span class="st">'y'</span>], forecast_real[<span class="st">'yhat'</span>])</span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span>ciudad<span class="sc">}</span><span class="ss"> - RMSE: </span><span class="sc">{</span>rmse<span class="sc">:.2f}</span><span class="ss"> | MAE: </span><span class="sc">{</span>mae<span class="sc">:.2f}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>Métricas de evaluación:

Leh Ladakh - RMSE: 2.95 | MAE: 2.77
Taj Mahal - RMSE: 3.68 | MAE: 3.46
Jaipur City - RMSE: 2.56 | MAE: 2.40
Kerala Backwaters - RMSE: 3.90 | MAE: 3.67
Goa Beaches - RMSE: 2.22 | MAE: 2.09</code></pre>
</section>
<section id="gráficas-de-predicción-vs.-demanda-real-para-cada-ruta-de-transporte." class="level3" data-number="2.0.2">
<h3 data-number="2.0.2" class="anchored" data-anchor-id="gráficas-de-predicción-vs.-demanda-real-para-cada-ruta-de-transporte."><span class="header-section-number">2.0.2</span> 3. - Gráficas de predicción vs.&nbsp;demanda real para cada ruta de transporte.</h3>
<div class="sourceCode" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Almacenar modelos y predicciones</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>predicciones_por_ciudad <span class="op">=</span> {}</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>modelos_por_ciudad <span class="op">=</span> {}</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> ciudad <span class="kw">in</span> top_5_ciudades:</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>    df_ciudad <span class="op">=</span> df_demand[df_demand[<span class="st">'Name_x'</span>] <span class="op">==</span> ciudad][[<span class="st">'VisitDate'</span>, <span class="st">'num_viajes'</span>]].copy()</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>    df_ciudad <span class="op">=</span> df_ciudad.rename(columns<span class="op">=</span>{<span class="st">'VisitDate'</span>: <span class="st">'ds'</span>, <span class="st">'num_viajes'</span>: <span class="st">'y'</span>}).sort_values(<span class="st">'ds'</span>)</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>    modelo <span class="op">=</span> Prophet(daily_seasonality<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>    modelo.fit(df_ciudad)</span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>    future <span class="op">=</span> modelo.make_future_dataframe(periods<span class="op">=</span><span class="dv">30</span>)</span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>    forecast <span class="op">=</span> modelo.predict(future)</span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>    predicciones_por_ciudad[ciudad] <span class="op">=</span> forecast</span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a>    modelos_por_ciudad[ciudad] <span class="op">=</span> modelo</span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Mostrar componentes para cada ciudad</span></span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> ciudad <span class="kw">in</span> top_5_ciudades:</span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Componentes del modelo para </span><span class="sc">{</span>ciudad<span class="sc">}</span><span class="ss">:"</span>)</span>
<span id="cb19-21"><a href="#cb19-21" aria-hidden="true" tabindex="-1"></a>    modelos_por_ciudad[ciudad].plot_components(predicciones_por_ciudad[ciudad])</span>
<span id="cb19-22"><a href="#cb19-22" aria-hidden="true" tabindex="-1"></a>    plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="análisis-de-la-estacionalidad-y-tendencias-de-la-demanda." class="level3" data-number="2.0.3">
<h3 data-number="2.0.3" class="anchored" data-anchor-id="análisis-de-la-estacionalidad-y-tendencias-de-la-demanda."><span class="header-section-number">2.0.3</span> 4. Análisis de la estacionalidad y tendencias de la demanda.</h3>
<div class="sourceCode" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Almacenar modelos y predicciones</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>predicciones_por_ciudad <span class="op">=</span> {}</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>modelos_por_ciudad <span class="op">=</span> {}</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> ciudad <span class="kw">in</span> top_5_ciudades:</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>    df_ciudad <span class="op">=</span> df_demand[df_demand[<span class="st">'Name_x'</span>] <span class="op">==</span> ciudad][[<span class="st">'VisitDate'</span>, <span class="st">'num_viajes'</span>]].copy()</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>    df_ciudad <span class="op">=</span> df_ciudad.rename(columns<span class="op">=</span>{<span class="st">'VisitDate'</span>: <span class="st">'ds'</span>, <span class="st">'num_viajes'</span>: <span class="st">'y'</span>}).sort_values(<span class="st">'ds'</span>)</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>    modelo <span class="op">=</span> Prophet(daily_seasonality<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>    modelo.fit(df_ciudad)</span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>    future <span class="op">=</span> modelo.make_future_dataframe(periods<span class="op">=</span><span class="dv">30</span>)</span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>    forecast <span class="op">=</span> modelo.predict(future)</span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>    predicciones_por_ciudad[ciudad] <span class="op">=</span> forecast</span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a>    modelos_por_ciudad[ciudad] <span class="op">=</span> modelo</span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Mostrar componentes para cada ciudad</span></span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> ciudad <span class="kw">in</span> top_5_ciudades:</span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Componentes del modelo para </span><span class="sc">{</span>ciudad<span class="sc">}</span><span class="ss">:"</span>)</span>
<span id="cb20-21"><a href="#cb20-21" aria-hidden="true" tabindex="-1"></a>    modelos_por_ciudad[ciudad].plot_components(predicciones_por_ciudad[ciudad])</span>
<span id="cb20-22"><a href="#cb20-22" aria-hidden="true" tabindex="-1"></a>    plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Aunque el dataset tiene un número limitado de fechas, se observan algunos indicios de variaciones diarias que podrían interpretarse como patrones estacionales si tuviéramos más datos. Prophet permite visualizar las componentes de tendencia, estacionalidad y efectos semanales o anuales. En este caso, no se observan componentes significativos por la escasez de datos, pero el modelo está correctamente estructurado para captarlas si se amplía la serie temporal.</p>
</section>
<section id="punto-3" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="punto-3"><span class="header-section-number">2.1</span> Punto 3</h2>
<p>#Importar librerías necesarias</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> LabelEncoder</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics.pairwise <span class="im">import</span> cosine_similarity</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> StandardScaler</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.utils.class_weight <span class="im">import</span> compute_class_weight</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> mean_squared_error, mean_absolute_error</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.decomposition <span class="im">import</span> TruncatedSVD</span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> MultiLabelBinarizer</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<section id="carga-de-datos" class="level3" data-number="2.1.1">
<h3 data-number="2.1.1" class="anchored" data-anchor-id="carga-de-datos"><span class="header-section-number">2.1.1</span> Carga de datos</h3>
<div class="sourceCode" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co">#ES NECESARIO SUBIR LOS CSV AL COLAB</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>destinations_df <span class="op">=</span> pd.read_csv(<span class="st">"Expanded_Destinations.csv"</span>)</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>reviews_df <span class="op">=</span> pd.read_csv(<span class="st">"Final_Updated_Expanded_Reviews.csv"</span>)</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>userhistory_df <span class="op">=</span> pd.read_csv(<span class="st">"Final_Updated_Expanded_UserHistory.csv"</span>)</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>users_df <span class="op">=</span> pd.read_csv(<span class="st">"Final_Updated_Expanded_Users.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tipado uniforme</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> df <span class="kw">in</span> [users_df, userhistory_df, reviews_df]:</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'UserID'</span>] <span class="op">=</span> df[<span class="st">'UserID'</span>].astype(<span class="bu">str</span>)</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> df <span class="kw">in</span> [destinations_df, userhistory_df, reviews_df]:</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'DestinationID'</span>] <span class="op">=</span> df[<span class="st">'DestinationID'</span>].astype(<span class="bu">str</span>)</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Combinar datasets</span></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>merged_df <span class="op">=</span> pd.merge(userhistory_df, users_df, on<span class="op">=</span><span class="st">'UserID'</span>, how<span class="op">=</span><span class="st">'left'</span>)</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>merged_df <span class="op">=</span> pd.merge(merged_df, destinations_df, on<span class="op">=</span><span class="st">'DestinationID'</span>, how<span class="op">=</span><span class="st">'left'</span>)</span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> merged_df</span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a>df.info()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 999 entries, 0 to 998
Data columns (total 16 columns):
 #   Column            Non-Null Count  Dtype  
---  ------            --------------  -----  
 0   HistoryID         999 non-null    int64  
 1   UserID            999 non-null    object 
 2   DestinationID     999 non-null    object 
 3   VisitDate         999 non-null    object 
 4   ExperienceRating  999 non-null    int64  
 5   Name_x            999 non-null    object 
 6   Email             999 non-null    object 
 7   Preferences       999 non-null    object 
 8   Gender            999 non-null    object 
 9   NumberOfAdults    999 non-null    int64  
 10  NumberOfChildren  999 non-null    int64  
 11  Name_y            999 non-null    object 
 12  State             999 non-null    object 
 13  Type              999 non-null    object 
 14  Popularity        999 non-null    float64
 15  BestTimeToVisit   999 non-null    object 
dtypes: float64(1), int64(4), object(11)
memory usage: 125.0+ KB</code></pre>
<div class="sourceCode" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Convertir la fecha a datetime </span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'VisitDate'</span>] <span class="op">=</span> pd.to_datetime(df[<span class="st">'VisitDate'</span>])</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="co">#Eliminar columnas irrelevantes</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>df_copia <span class="op">=</span> df.drop(columns<span class="op">=</span>[<span class="st">'HistoryID'</span>,<span class="st">'Name_x'</span>,<span class="st">'Email'</span>])</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a><span class="co">#Normalizando columnas categóricas</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>df_copia[<span class="st">'PreferencesList'</span>] <span class="op">=</span> df_copia[<span class="st">'Preferences'</span>].<span class="bu">str</span>.split(<span class="st">','</span>)</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>df_copia[<span class="st">'Type'</span>] <span class="op">=</span> df_copia[<span class="st">'Type'</span>].<span class="bu">str</span>.lower()</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>df_copia[<span class="st">'BestTimeToVisit'</span>] <span class="op">=</span> df_copia[<span class="st">'BestTimeToVisit'</span>].<span class="bu">str</span>.lower()</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>df_copia[<span class="st">'PopularityNormalizado'</span>] <span class="op">=</span> (df_copia[<span class="st">'Popularity'</span>] <span class="op">-</span> df_copia[<span class="st">'Popularity'</span>].<span class="bu">min</span>()) <span class="op">/</span> (df_copia[<span class="st">'Popularity'</span>].<span class="bu">max</span>() <span class="op">-</span> df_copia[<span class="st">'Popularity'</span>].<span class="bu">min</span>())</span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>df_copia[<span class="st">'ExperienceRatingNormalizado'</span>] <span class="op">=</span> (df_copia[<span class="st">'ExperienceRating'</span>] <span class="op">-</span> df_copia[<span class="st">'ExperienceRating'</span>].<span class="bu">min</span>()) <span class="op">/</span> (df_copia[<span class="st">'ExperienceRating'</span>].<span class="bu">max</span>() <span class="op">-</span> df_copia[<span class="st">'ExperienceRating'</span>].<span class="bu">min</span>())</span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>df_copia.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="df-f5309b41-e607-448b-8b18-e18f507b4227" class="colab-df-container">
<pre><code>&lt;div&gt;</code></pre>

<table class="dataframe table table-sm table-striped small">
<thead>
<tr>
<th>
</th>
<th>
UserID
</th>
<th>
DestinationID
</th>
<th>
VisitDate
</th>
<th>
ExperienceRating
</th>
<th>
Preferences
</th>
<th>
Gender
</th>
<th>
NumberOfAdults
</th>
<th>
NumberOfChildren
</th>
<th>
Name_y
</th>
<th>
State
</th>
<th>
Type
</th>
<th>
Popularity
</th>
<th>
BestTimeToVisit
</th>
<th>
PreferencesList
</th>
<th>
PopularityNormalizado
</th>
<th>
ExperienceRatingNormalizado
</th>
</tr>
</thead>
<tbody>
<tr>
<th>
0
</th>
<td>
525
</td>
<td>
760
</td>
<td>
2024-01-01
</td>
<td>
3
</td>
<td>
City, Historical
</td>
<td>
Female
</td>
<td>
2
</td>
<td>
2
</td>
<td>
Leh Ladakh
</td>
<td>
Jammu and Kashmir
</td>
<td>
adventure
</td>
<td>
8.352180
</td>
<td>
apr-jun
</td>
<td>
[City, Historical]
</td>
<td>
0.424836
</td>
<td>
0.50
</td>
</tr>
<tr>
<th>
1
</th>
<td>
184
</td>
<td>
532
</td>
<td>
2024-02-15
</td>
<td>
5
</td>
<td>
Beaches, Historical
</td>
<td>
Male
</td>
<td>
1
</td>
<td>
2
</td>
<td>
Goa Beaches
</td>
<td>
Goa
</td>
<td>
beach
</td>
<td>
8.988127
</td>
<td>
nov-mar
</td>
<td>
[Beaches, Historical]
</td>
<td>
0.743557
</td>
<td>
1.00
</td>
</tr>
<tr>
<th>
2
</th>
<td>
897
</td>
<td>
786
</td>
<td>
2024-03-20
</td>
<td>
2
</td>
<td>
City, Historical
</td>
<td>
Female
</td>
<td>
1
</td>
<td>
2
</td>
<td>
Taj Mahal
</td>
<td>
Uttar Pradesh
</td>
<td>
historical
</td>
<td>
8.389206
</td>
<td>
nov-feb
</td>
<td>
[City, Historical]
</td>
<td>
0.443392
</td>
<td>
0.25
</td>
</tr>
<tr>
<th>
3
</th>
<td>
470
</td>
<td>
660
</td>
<td>
2024-01-01
</td>
<td>
1
</td>
<td>
Nature, Adventure
</td>
<td>
Male
</td>
<td>
2
</td>
<td>
1
</td>
<td>
Leh Ladakh
</td>
<td>
Jammu and Kashmir
</td>
<td>
adventure
</td>
<td>
7.923388
</td>
<td>
apr-jun
</td>
<td>
[Nature, Adventure]
</td>
<td>
0.209936
</td>
<td>
0.00
</td>
</tr>
<tr>
<th>
4
</th>
<td>
989
</td>
<td>
389
</td>
<td>
2024-02-15
</td>
<td>
4
</td>
<td>
Nature, Adventure
</td>
<td>
Male
</td>
<td>
2
</td>
<td>
1
</td>
<td>
Kerala Backwaters
</td>
<td>
Kerala
</td>
<td>
nature
</td>
<td>
9.409146
</td>
<td>
sep-mar
</td>
<td>
[Nature, Adventure]
</td>
<td>
0.954561
</td>
<td>
0.75
</td>
</tr>
</tbody>
</table>
</div>
<pre><code>&lt;div class="colab-df-buttons"&gt;</code></pre>
<div class="colab-df-container">
<pre><code>&lt;button class="colab-df-convert" onclick="convertToInteractive('df-f5309b41-e607-448b-8b18-e18f507b4227')"
        title="Convert this dataframe to an interactive table."
        style="display:none;"&gt;</code></pre>
<p><svg xmlns="http://www.w3.org/2000/svg" height="24px" viewbox="0 -960 960 960"> <path d="M120-120v-720h720v720H120Zm60-500h600v-160H180v160Zm220 220h160v-160H400v160Zm0 220h160v-160H400v160ZM180-400h160v-160H180v160Zm440 0h160v-160H620v160ZM180-180h160v-160H180v160Zm440 0h160v-160H620v160Z"></path></svg></p>
<p>Creación de la matriz de usuarios para hacer la recomendación de destinos de viaje.</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>user_item_matrix <span class="op">=</span> df_copia.pivot_table(index<span class="op">=</span><span class="st">'UserID'</span>, columns<span class="op">=</span><span class="st">'DestinationID'</span>, values<span class="op">=</span><span class="st">'ExperienceRatingNormalizado'</span>, fill_value<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>svd <span class="op">=</span> TruncatedSVD(n_components<span class="op">=</span><span class="dv">20</span>, random_state<span class="op">=</span><span class="dv">42</span>)</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>item_embeddings <span class="op">=</span> svd.fit_transform(user_item_matrix.T)</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>destination_similarity <span class="op">=</span> cosine_similarity(item_embeddings)</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Índices de destinos</span></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>destination_indices <span class="op">=</span> {</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>    dest: idx <span class="cf">for</span> idx, dest <span class="kw">in</span> <span class="bu">enumerate</span>(user_item_matrix.columns)</span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Base para contenido</span></span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a>destination_content <span class="op">=</span> df_copia[[</span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">"DestinationID"</span>,</span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Name_y"</span>,</span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a>    <span class="st">"PopularityNormalizado"</span>,</span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a>    <span class="st">"PreferencesList"</span>,</span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Type"</span>,</span>
<span id="cb29-18"><a href="#cb29-18" aria-hidden="true" tabindex="-1"></a>    <span class="st">"BestTimeToVisit"</span></span>
<span id="cb29-19"><a href="#cb29-19" aria-hidden="true" tabindex="-1"></a>]].drop_duplicates(subset<span class="op">=</span>[<span class="st">"DestinationID"</span>])</span>
<span id="cb29-20"><a href="#cb29-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-21"><a href="#cb29-21" aria-hidden="true" tabindex="-1"></a><span class="co"># MultiLabelBinarizer para PreferencesList (lista de preferencias de los usuarios)</span></span>
<span id="cb29-22"><a href="#cb29-22" aria-hidden="true" tabindex="-1"></a>mlb <span class="op">=</span> MultiLabelBinarizer()</span>
<span id="cb29-23"><a href="#cb29-23" aria-hidden="true" tabindex="-1"></a>prefs_encoded <span class="op">=</span> pd.DataFrame(</span>
<span id="cb29-24"><a href="#cb29-24" aria-hidden="true" tabindex="-1"></a>    mlb.fit_transform(destination_content[<span class="st">"PreferencesList"</span>]),</span>
<span id="cb29-25"><a href="#cb29-25" aria-hidden="true" tabindex="-1"></a>    columns<span class="op">=</span>[<span class="ss">f"Pref_</span><span class="sc">{</span>c<span class="sc">}</span><span class="ss">"</span> <span class="cf">for</span> c <span class="kw">in</span> mlb.classes_]</span>
<span id="cb29-26"><a href="#cb29-26" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb29-27"><a href="#cb29-27" aria-hidden="true" tabindex="-1"></a>prefs_encoded.index <span class="op">=</span> destination_content.index</span>
<span id="cb29-28"><a href="#cb29-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-29"><a href="#cb29-29" aria-hidden="true" tabindex="-1"></a><span class="co"># One-hot encode Type y BestTimeToVisit</span></span>
<span id="cb29-30"><a href="#cb29-30" aria-hidden="true" tabindex="-1"></a>dummies <span class="op">=</span> pd.get_dummies(destination_content[[<span class="st">"Type"</span>, <span class="st">"BestTimeToVisit"</span>]])</span>
<span id="cb29-31"><a href="#cb29-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-32"><a href="#cb29-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Concatenar</span></span>
<span id="cb29-33"><a href="#cb29-33" aria-hidden="true" tabindex="-1"></a>destination_content_encoded <span class="op">=</span> pd.concat([</span>
<span id="cb29-34"><a href="#cb29-34" aria-hidden="true" tabindex="-1"></a>    destination_content[[<span class="st">"DestinationID"</span>, <span class="st">"Name_y"</span>, <span class="st">"PopularityNormalizado"</span>]],</span>
<span id="cb29-35"><a href="#cb29-35" aria-hidden="true" tabindex="-1"></a>    dummies,</span>
<span id="cb29-36"><a href="#cb29-36" aria-hidden="true" tabindex="-1"></a>    prefs_encoded</span>
<span id="cb29-37"><a href="#cb29-37" aria-hidden="true" tabindex="-1"></a>], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb29-38"><a href="#cb29-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-39"><a href="#cb29-39" aria-hidden="true" tabindex="-1"></a><span class="co"># Asegurarse que todo sea float</span></span>
<span id="cb29-40"><a href="#cb29-40" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> col <span class="kw">in</span> destination_content_encoded.columns:</span>
<span id="cb29-41"><a href="#cb29-41" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> destination_content_encoded[col].dtype <span class="kw">in</span> [<span class="bu">bool</span>, <span class="bu">int</span>]:</span>
<span id="cb29-42"><a href="#cb29-42" aria-hidden="true" tabindex="-1"></a>        destination_content_encoded[col] <span class="op">=</span> destination_content_encoded[col].astype(<span class="bu">float</span>)</span>
<span id="cb29-43"><a href="#cb29-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-44"><a href="#cb29-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-45"><a href="#cb29-45" aria-hidden="true" tabindex="-1"></a>user_similarity <span class="op">=</span> cosine_similarity(destination_content_encoded.drop(columns<span class="op">=</span>[<span class="st">"DestinationID"</span>, <span class="st">"Name_y"</span>]) )</span>
<span id="cb29-46"><a href="#cb29-46" aria-hidden="true" tabindex="-1"></a>destinations_names <span class="op">=</span> df_copia[[<span class="st">'DestinationID'</span>, <span class="st">'Name_y'</span>]].drop_duplicates()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<section id="función-para-recomendación-de-los-top-5-destinos-con-un-alpha-de-0.5-uno-con-base-en-destinos-similares-que-el-usuario-ya-visitó-collab_scores-y-otro-con-base-en-contenido-de-los-destinos-ya-visitados-content_scores-el-alpha-determinar-que-ambos-parámetros-tienen-la-misma-importancia." class="level3" data-number="2.1.2">
<h3 data-number="2.1.2" class="anchored" data-anchor-id="función-para-recomendación-de-los-top-5-destinos-con-un-alpha-de-0.5-uno-con-base-en-destinos-similares-que-el-usuario-ya-visitó-collab_scores-y-otro-con-base-en-contenido-de-los-destinos-ya-visitados-content_scores-el-alpha-determinar-que-ambos-parámetros-tienen-la-misma-importancia."><span class="header-section-number">2.1.2</span> Función para recomendación de los top 5 destinos con un alpha de 0.5 (uno con base en destinos similares que el usuario ya visitó collab_scores y otro con base en contenido de los destinos ya visitados content_scores) el alpha determinar que ambos parámetros tienen la misma importancia.</h3>
<div class="sourceCode" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> recommend_destinations(user_id,top_n<span class="op">=</span><span class="dv">5</span>,alpha<span class="op">=</span><span class="fl">0.5</span>):</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> user_id <span class="kw">not</span> <span class="kw">in</span> user_item_matrix.index:</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">'Usuario no válido'</span>)</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>  visited_destinations <span class="op">=</span> user_item_matrix.columns[user_item_matrix.loc[user_id] <span class="op">&gt;</span> <span class="dv">0</span>]</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>  collab_scores <span class="op">=</span> np.zeros(<span class="bu">len</span>(user_item_matrix.columns))</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>  content_scores <span class="op">=</span> np.zeros(<span class="bu">len</span>(user_item_matrix.columns))</span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> d <span class="kw">in</span> visited_destinations:</span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>    idx <span class="op">=</span> destination_indices[d]</span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>    collab_scores <span class="op">+=</span> destination_similarity[idx]</span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a>    content_scores <span class="op">+=</span> user_similarity[idx]</span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> <span class="bu">len</span>(visited_destinations) <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a>    collab_scores <span class="op">/=</span> <span class="bu">len</span>(visited_destinations)</span>
<span id="cb30-16"><a href="#cb30-16" aria-hidden="true" tabindex="-1"></a>    content_scores <span class="op">/=</span> <span class="bu">len</span>(visited_destinations)</span>
<span id="cb30-17"><a href="#cb30-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-18"><a href="#cb30-18" aria-hidden="true" tabindex="-1"></a>  hybrid_scores <span class="op">=</span> alpha <span class="op">*</span> collab_scores <span class="op">+</span> (<span class="dv">1</span> <span class="op">-</span> alpha) <span class="op">*</span> content_scores</span>
<span id="cb30-19"><a href="#cb30-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-20"><a href="#cb30-20" aria-hidden="true" tabindex="-1"></a>  recommendations <span class="op">=</span> pd.DataFrame({</span>
<span id="cb30-21"><a href="#cb30-21" aria-hidden="true" tabindex="-1"></a>      <span class="st">"DestinationID"</span>: user_item_matrix.columns,</span>
<span id="cb30-22"><a href="#cb30-22" aria-hidden="true" tabindex="-1"></a>      <span class="st">"HybridScore"</span>: hybrid_scores</span>
<span id="cb30-23"><a href="#cb30-23" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb30-24"><a href="#cb30-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-25"><a href="#cb30-25" aria-hidden="true" tabindex="-1"></a>  recommendations <span class="op">=</span> recommendations[<span class="op">~</span>recommendations[<span class="st">"DestinationID"</span>].isin(visited_destinations)]</span>
<span id="cb30-26"><a href="#cb30-26" aria-hidden="true" tabindex="-1"></a>  recommendations <span class="op">=</span> recommendations.merge(destinations_names, on<span class="op">=</span><span class="st">"DestinationID"</span>, how<span class="op">=</span><span class="st">"left"</span>)</span>
<span id="cb30-27"><a href="#cb30-27" aria-hidden="true" tabindex="-1"></a>  recommendations <span class="op">=</span> recommendations.groupby(<span class="st">"Name_y"</span>).agg({<span class="st">"HybridScore"</span>: <span class="st">"mean"</span>}).reset_index()</span>
<span id="cb30-28"><a href="#cb30-28" aria-hidden="true" tabindex="-1"></a>  recommendations <span class="op">=</span> recommendations.sort_values(<span class="st">"HybridScore"</span>, ascending<span class="op">=</span><span class="va">False</span>).head(top_n)</span>
<span id="cb30-29"><a href="#cb30-29" aria-hidden="true" tabindex="-1"></a>  recommendations <span class="op">=</span> recommendations.rename(columns<span class="op">=</span>{<span class="st">"Name_y"</span>: <span class="st">"DestinationName"</span>})</span>
<span id="cb30-30"><a href="#cb30-30" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> recommendations</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="ahora-pasamos-a-la-función-para-recomendación-por-perfil-del-usuario.-ideal-para-usuarios-nuevos" class="level3" data-number="2.1.3">
<h3 data-number="2.1.3" class="anchored" data-anchor-id="ahora-pasamos-a-la-función-para-recomendación-por-perfil-del-usuario.-ideal-para-usuarios-nuevos"><span class="header-section-number">2.1.3</span> Ahora pasamos a la función para recomendación por perfil del usuario. (ideal para usuarios nuevos)</h3>
<div class="sourceCode" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> recommend_by_profile(user_profile, top_n<span class="op">=</span><span class="dv">5</span>):</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># One-hot de Type (puedes cambiar la lógica si quieres)</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>    type_cols <span class="op">=</span> [c <span class="cf">for</span> c <span class="kw">in</span> destination_content_encoded.columns <span class="cf">if</span> c.startswith(<span class="st">"Type_"</span>)]</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>    type_vec <span class="op">=</span> pd.Series(<span class="fl">0.0</span>, index<span class="op">=</span>type_cols)</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># One-hot de BestTimeToVisit (puedes ajustar la lógica)</span></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>    time_cols <span class="op">=</span> [c <span class="cf">for</span> c <span class="kw">in</span> destination_content_encoded.columns <span class="cf">if</span> c.startswith(<span class="st">"BestTimeToVisit_"</span>)]</span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>    time_vec <span class="op">=</span> pd.Series(<span class="fl">0.0</span>, index<span class="op">=</span>time_cols)</span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># MultiLabel de Preferences</span></span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a>    pref_cols <span class="op">=</span> [c <span class="cf">for</span> c <span class="kw">in</span> destination_content_encoded.columns <span class="cf">if</span> c.startswith(<span class="st">"Pref_"</span>)]</span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a>    pref_vec <span class="op">=</span> pd.Series(<span class="fl">0.0</span>, index<span class="op">=</span>pref_cols)</span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> pref <span class="kw">in</span> user_profile[<span class="st">"Preferences"</span>].split(<span class="st">", "</span>):</span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a>        col <span class="op">=</span> <span class="ss">f"Pref_</span><span class="sc">{</span>pref<span class="sc">.</span>strip()<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> col <span class="kw">in</span> pref_vec.index:</span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a>            pref_vec[col] <span class="op">=</span> <span class="fl">1.0</span></span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-18"><a href="#cb31-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Popularidad media</span></span>
<span id="cb31-19"><a href="#cb31-19" aria-hidden="true" tabindex="-1"></a>    popularity_mean <span class="op">=</span> destination_content_encoded[<span class="st">"PopularityNormalizado"</span>].mean()</span>
<span id="cb31-20"><a href="#cb31-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-21"><a href="#cb31-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Concatenar</span></span>
<span id="cb31-22"><a href="#cb31-22" aria-hidden="true" tabindex="-1"></a>    user_vector <span class="op">=</span> pd.concat([</span>
<span id="cb31-23"><a href="#cb31-23" aria-hidden="true" tabindex="-1"></a>        pd.Series({<span class="st">"PopularityNormalizado"</span>: popularity_mean}),</span>
<span id="cb31-24"><a href="#cb31-24" aria-hidden="true" tabindex="-1"></a>        type_vec,</span>
<span id="cb31-25"><a href="#cb31-25" aria-hidden="true" tabindex="-1"></a>        time_vec,</span>
<span id="cb31-26"><a href="#cb31-26" aria-hidden="true" tabindex="-1"></a>        pref_vec</span>
<span id="cb31-27"><a href="#cb31-27" aria-hidden="true" tabindex="-1"></a>    ]).to_frame().T</span>
<span id="cb31-28"><a href="#cb31-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-29"><a href="#cb31-29" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Ordenar columnas igual que en destino</span></span>
<span id="cb31-30"><a href="#cb31-30" aria-hidden="true" tabindex="-1"></a>    user_vector <span class="op">=</span> user_vector[destination_content_encoded.drop(columns<span class="op">=</span>[<span class="st">"DestinationID"</span>, <span class="st">"Name_y"</span>]).columns]</span>
<span id="cb31-31"><a href="#cb31-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-32"><a href="#cb31-32" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Convertir a float</span></span>
<span id="cb31-33"><a href="#cb31-33" aria-hidden="true" tabindex="-1"></a>    user_vector <span class="op">=</span> user_vector.astype(<span class="bu">float</span>)</span>
<span id="cb31-34"><a href="#cb31-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-35"><a href="#cb31-35" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Similitud</span></span>
<span id="cb31-36"><a href="#cb31-36" aria-hidden="true" tabindex="-1"></a>    sim <span class="op">=</span> cosine_similarity(</span>
<span id="cb31-37"><a href="#cb31-37" aria-hidden="true" tabindex="-1"></a>        destination_content_encoded.drop(columns<span class="op">=</span>[<span class="st">"DestinationID"</span>, <span class="st">"Name_y"</span>]),</span>
<span id="cb31-38"><a href="#cb31-38" aria-hidden="true" tabindex="-1"></a>        user_vector</span>
<span id="cb31-39"><a href="#cb31-39" aria-hidden="true" tabindex="-1"></a>    ).flatten()</span>
<span id="cb31-40"><a href="#cb31-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-41"><a href="#cb31-41" aria-hidden="true" tabindex="-1"></a>    recommendations <span class="op">=</span> destination_content_encoded[[<span class="st">"DestinationID"</span>, <span class="st">"Name_y"</span>]].copy()</span>
<span id="cb31-42"><a href="#cb31-42" aria-hidden="true" tabindex="-1"></a>    recommendations[<span class="st">"Similarity"</span>] <span class="op">=</span> sim</span>
<span id="cb31-43"><a href="#cb31-43" aria-hidden="true" tabindex="-1"></a>    recommendations <span class="op">=</span> recommendations.sort_values(<span class="st">"Similarity"</span>, ascending<span class="op">=</span><span class="va">False</span>).head(top_n)</span>
<span id="cb31-44"><a href="#cb31-44" aria-hidden="true" tabindex="-1"></a>    recommendations <span class="op">=</span> recommendations.rename(columns<span class="op">=</span>{<span class="st">"Name_y"</span>: <span class="st">"DestinationName"</span>})</span>
<span id="cb31-45"><a href="#cb31-45" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> recommendations</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Recomendación híbrida basada en historial</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>sample_user <span class="op">=</span> df_copia[<span class="st">"UserID"</span>].iloc[<span class="dv">0</span>]</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>recs_hybrid <span class="op">=</span> recommend_destinations(sample_user, top_n<span class="op">=</span><span class="dv">3</span>, alpha<span class="op">=</span><span class="fl">0.6</span>)</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">=== Recomendaciones híbridas ==="</span>)</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(recs_hybrid)</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Recomendación basada en perfil</span></span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>user_profile <span class="op">=</span> {</span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Preferences"</span>: <span class="st">"Nature, Adventure"</span>,</span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Gender"</span>: <span class="st">"Female"</span>,</span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">"NumberOfAdults"</span>: <span class="dv">2</span>,</span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">"NumberOfChildren"</span>: <span class="dv">1</span></span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a>recs_profile <span class="op">=</span> recommend_by_profile(user_profile)</span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">=== Recomendaciones basadas en perfil ==="</span>)</span>
<span id="cb32-16"><a href="#cb32-16" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(recs_profile)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>=== Recomendaciones híbridas ===
  DestinationName  HybridScore
1     Jaipur City     0.155404
0     Goa Beaches     0.155140
4       Taj Mahal     0.147836

=== Recomendaciones basadas en perfil ===
    DestinationID    DestinationName  Similarity
860           987        Goa Beaches    0.601030
517           468        Jaipur City    0.600173
31            114  Kerala Backwaters    0.599672
207           684  Kerala Backwaters    0.599624
84            130         Leh Ladakh    0.599397</code></pre>
</section>
<section id="evaluación-de-métricas" class="level3" data-number="2.1.4">
<h3 data-number="2.1.4" class="anchored" data-anchor-id="evaluación-de-métricas"><span class="header-section-number">2.1.4</span> Evaluación de métricas</h3>
<div class="sourceCode" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> random</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a><span class="co"># -------------------------------</span></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Generador automático de perfiles</span></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a><span class="co"># -------------------------------</span></span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> generate_random_profiles(n_profiles<span class="op">=</span><span class="dv">50</span>):</span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>    possible_preferences <span class="op">=</span> [</span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Nature"</span>, <span class="st">"Adventure"</span>, <span class="st">"Culture"</span>, <span class="st">"Relaxation"</span>, <span class="st">"Beach"</span>, <span class="st">"Gastronomy"</span></span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a>    genders <span class="op">=</span> [<span class="st">"Female"</span>, <span class="st">"Male"</span>]</span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a>    num_adults_options <span class="op">=</span> [<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>]</span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a>    num_children_options <span class="op">=</span> [<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>]</span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a>    profiles <span class="op">=</span> []</span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(n_profiles):</span>
<span id="cb34-16"><a href="#cb34-16" aria-hidden="true" tabindex="-1"></a>        selected_prefs <span class="op">=</span> random.sample(possible_preferences, k<span class="op">=</span>random.randint(<span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb34-17"><a href="#cb34-17" aria-hidden="true" tabindex="-1"></a>        profile <span class="op">=</span> {</span>
<span id="cb34-18"><a href="#cb34-18" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Preferences"</span>: <span class="st">", "</span>.join(selected_prefs),</span>
<span id="cb34-19"><a href="#cb34-19" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Gender"</span>: random.choice(genders),</span>
<span id="cb34-20"><a href="#cb34-20" aria-hidden="true" tabindex="-1"></a>            <span class="st">"NumberOfAdults"</span>: random.choice(num_adults_options),</span>
<span id="cb34-21"><a href="#cb34-21" aria-hidden="true" tabindex="-1"></a>            <span class="st">"NumberOfChildren"</span>: random.choice(num_children_options)</span>
<span id="cb34-22"><a href="#cb34-22" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb34-23"><a href="#cb34-23" aria-hidden="true" tabindex="-1"></a>        profiles.append(profile)</span>
<span id="cb34-24"><a href="#cb34-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-25"><a href="#cb34-25" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> profiles</span>
<span id="cb34-26"><a href="#cb34-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-27"><a href="#cb34-27" aria-hidden="true" tabindex="-1"></a><span class="co"># -------------------------------</span></span>
<span id="cb34-28"><a href="#cb34-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluación contra múltiples usuarios</span></span>
<span id="cb34-29"><a href="#cb34-29" aria-hidden="true" tabindex="-1"></a><span class="co"># -------------------------------</span></span>
<span id="cb34-30"><a href="#cb34-30" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> evaluate_profile_recommendations_against_multiple_users(user_profile, recommended_df, user_ids):</span>
<span id="cb34-31"><a href="#cb34-31" aria-hidden="true" tabindex="-1"></a>    recommended_names <span class="op">=</span> <span class="bu">set</span>(recommended_df[<span class="st">"DestinationName"</span>].values)</span>
<span id="cb34-32"><a href="#cb34-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-33"><a href="#cb34-33" aria-hidden="true" tabindex="-1"></a>    precisions <span class="op">=</span> []</span>
<span id="cb34-34"><a href="#cb34-34" aria-hidden="true" tabindex="-1"></a>    recalls <span class="op">=</span> []</span>
<span id="cb34-35"><a href="#cb34-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-36"><a href="#cb34-36" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> uid <span class="kw">in</span> user_ids:</span>
<span id="cb34-37"><a href="#cb34-37" aria-hidden="true" tabindex="-1"></a>        actual_destinations <span class="op">=</span> <span class="bu">set</span>(df_copia[df_copia[<span class="st">"UserID"</span>] <span class="op">==</span> uid][<span class="st">"Name_y"</span>].unique())</span>
<span id="cb34-38"><a href="#cb34-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-39"><a href="#cb34-39" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> actual_destinations:</span>
<span id="cb34-40"><a href="#cb34-40" aria-hidden="true" tabindex="-1"></a>            <span class="cf">continue</span>  <span class="co"># Saltar usuarios sin historial</span></span>
<span id="cb34-41"><a href="#cb34-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-42"><a href="#cb34-42" aria-hidden="true" tabindex="-1"></a>        hits <span class="op">=</span> recommended_names.intersection(actual_destinations)</span>
<span id="cb34-43"><a href="#cb34-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-44"><a href="#cb34-44" aria-hidden="true" tabindex="-1"></a>        precision <span class="op">=</span> <span class="bu">len</span>(hits) <span class="op">/</span> <span class="bu">len</span>(recommended_names) <span class="cf">if</span> recommended_names <span class="cf">else</span> <span class="dv">0</span></span>
<span id="cb34-45"><a href="#cb34-45" aria-hidden="true" tabindex="-1"></a>        recall <span class="op">=</span> <span class="bu">len</span>(hits) <span class="op">/</span> <span class="bu">len</span>(actual_destinations) <span class="cf">if</span> actual_destinations <span class="cf">else</span> <span class="dv">0</span></span>
<span id="cb34-46"><a href="#cb34-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-47"><a href="#cb34-47" aria-hidden="true" tabindex="-1"></a>        precisions.append(precision)</span>
<span id="cb34-48"><a href="#cb34-48" aria-hidden="true" tabindex="-1"></a>        recalls.append(recall)</span>
<span id="cb34-49"><a href="#cb34-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-50"><a href="#cb34-50" aria-hidden="true" tabindex="-1"></a>    avg_precision <span class="op">=</span> <span class="bu">sum</span>(precisions) <span class="op">/</span> <span class="bu">len</span>(precisions) <span class="cf">if</span> precisions <span class="cf">else</span> <span class="va">None</span></span>
<span id="cb34-51"><a href="#cb34-51" aria-hidden="true" tabindex="-1"></a>    avg_recall <span class="op">=</span> <span class="bu">sum</span>(recalls) <span class="op">/</span> <span class="bu">len</span>(recalls) <span class="cf">if</span> recalls <span class="cf">else</span> <span class="va">None</span></span>
<span id="cb34-52"><a href="#cb34-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-53"><a href="#cb34-53" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> avg_precision, avg_recall</span>
<span id="cb34-54"><a href="#cb34-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-55"><a href="#cb34-55" aria-hidden="true" tabindex="-1"></a><span class="co"># -------------------------------</span></span>
<span id="cb34-56"><a href="#cb34-56" aria-hidden="true" tabindex="-1"></a><span class="co"># Generar perfiles de prueba</span></span>
<span id="cb34-57"><a href="#cb34-57" aria-hidden="true" tabindex="-1"></a><span class="co"># -------------------------------</span></span>
<span id="cb34-58"><a href="#cb34-58" aria-hidden="true" tabindex="-1"></a>test_profiles <span class="op">=</span> generate_random_profiles(n_profiles<span class="op">=</span><span class="dv">50</span>)</span>
<span id="cb34-59"><a href="#cb34-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-60"><a href="#cb34-60" aria-hidden="true" tabindex="-1"></a><span class="co"># -------------------------------</span></span>
<span id="cb34-61"><a href="#cb34-61" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluar todos los perfiles</span></span>
<span id="cb34-62"><a href="#cb34-62" aria-hidden="true" tabindex="-1"></a><span class="co"># -------------------------------</span></span>
<span id="cb34-63"><a href="#cb34-63" aria-hidden="true" tabindex="-1"></a>all_user_ids <span class="op">=</span> df_copia[<span class="st">"UserID"</span>].unique()</span>
<span id="cb34-64"><a href="#cb34-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-65"><a href="#cb34-65" aria-hidden="true" tabindex="-1"></a>all_precisions <span class="op">=</span> []</span>
<span id="cb34-66"><a href="#cb34-66" aria-hidden="true" tabindex="-1"></a>all_recalls <span class="op">=</span> []</span>
<span id="cb34-67"><a href="#cb34-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-68"><a href="#cb34-68" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> idx, profile <span class="kw">in</span> <span class="bu">enumerate</span>(test_profiles):</span>
<span id="cb34-69"><a href="#cb34-69" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Generar recomendaciones para este perfil</span></span>
<span id="cb34-70"><a href="#cb34-70" aria-hidden="true" tabindex="-1"></a>    recs_profile <span class="op">=</span> recommend_by_profile(profile, top_n<span class="op">=</span><span class="dv">5</span>)</span>
<span id="cb34-71"><a href="#cb34-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-72"><a href="#cb34-72" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Evaluar contra todos los usuarios reales</span></span>
<span id="cb34-73"><a href="#cb34-73" aria-hidden="true" tabindex="-1"></a>    avg_precision, avg_recall <span class="op">=</span> evaluate_profile_recommendations_against_multiple_users(</span>
<span id="cb34-74"><a href="#cb34-74" aria-hidden="true" tabindex="-1"></a>        profile, recs_profile, all_user_ids</span>
<span id="cb34-75"><a href="#cb34-75" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb34-76"><a href="#cb34-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-77"><a href="#cb34-77" aria-hidden="true" tabindex="-1"></a>    all_precisions.append(avg_precision)</span>
<span id="cb34-78"><a href="#cb34-78" aria-hidden="true" tabindex="-1"></a>    all_recalls.append(avg_recall)</span>
<span id="cb34-79"><a href="#cb34-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-80"><a href="#cb34-80" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Perfil </span><span class="sc">{</span>idx<span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss">: Precision=</span><span class="sc">{</span>avg_precision<span class="sc">:.3f}</span><span class="ss">, Recall=</span><span class="sc">{</span>avg_recall<span class="sc">:.3f}</span><span class="ss">"</span>)</span>
<span id="cb34-81"><a href="#cb34-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-82"><a href="#cb34-82" aria-hidden="true" tabindex="-1"></a><span class="co"># -------------------------------</span></span>
<span id="cb34-83"><a href="#cb34-83" aria-hidden="true" tabindex="-1"></a><span class="co"># Métricas promedio globales</span></span>
<span id="cb34-84"><a href="#cb34-84" aria-hidden="true" tabindex="-1"></a><span class="co"># -------------------------------</span></span>
<span id="cb34-85"><a href="#cb34-85" aria-hidden="true" tabindex="-1"></a>overall_precision <span class="op">=</span> <span class="bu">sum</span>(all_precisions) <span class="op">/</span> <span class="bu">len</span>(all_precisions)</span>
<span id="cb34-86"><a href="#cb34-86" aria-hidden="true" tabindex="-1"></a>overall_recall <span class="op">=</span> <span class="bu">sum</span>(all_recalls) <span class="op">/</span> <span class="bu">len</span>(all_recalls)</span>
<span id="cb34-87"><a href="#cb34-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-88"><a href="#cb34-88" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">=== Métricas de evaluación global (promedio sobre perfiles aleatorios) ==="</span>)</span>
<span id="cb34-89"><a href="#cb34-89" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Precision promedio global: </span><span class="sc">{</span>overall_precision<span class="sc">:.3f}</span><span class="ss">"</span>)</span>
<span id="cb34-90"><a href="#cb34-90" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Recall promedio global: </span><span class="sc">{</span>overall_recall<span class="sc">:.3f}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>Perfil 1: Precision=0.282, Recall=0.802
Perfil 2: Precision=0.278, Recall=0.591
Perfil 3: Precision=0.278, Recall=0.591
Perfil 4: Precision=0.278, Recall=0.591
Perfil 5: Precision=0.282, Recall=0.802
Perfil 6: Precision=0.278, Recall=0.591
Perfil 7: Precision=0.282, Recall=0.802
Perfil 8: Precision=0.282, Recall=0.802
Perfil 9: Precision=0.282, Recall=0.802
Perfil 10: Precision=0.278, Recall=0.591
Perfil 11: Precision=0.278, Recall=0.591
Perfil 12: Precision=0.278, Recall=0.591
Perfil 13: Precision=0.278, Recall=0.591
Perfil 14: Precision=0.278, Recall=0.591
Perfil 15: Precision=0.278, Recall=0.591
Perfil 16: Precision=0.278, Recall=0.591
Perfil 17: Precision=0.278, Recall=0.591
Perfil 18: Precision=0.282, Recall=0.802
Perfil 19: Precision=0.278, Recall=0.591
Perfil 20: Precision=0.278, Recall=0.591
Perfil 21: Precision=0.278, Recall=0.591
Perfil 22: Precision=0.282, Recall=0.802
Perfil 23: Precision=0.278, Recall=0.591
Perfil 24: Precision=0.278, Recall=0.591
Perfil 25: Precision=0.278, Recall=0.591
Perfil 26: Precision=0.278, Recall=0.591
Perfil 27: Precision=0.278, Recall=0.591
Perfil 28: Precision=0.282, Recall=0.802
Perfil 29: Precision=0.278, Recall=0.591
Perfil 30: Precision=0.278, Recall=0.591
Perfil 31: Precision=0.278, Recall=0.591
Perfil 32: Precision=0.282, Recall=0.802
Perfil 33: Precision=0.278, Recall=0.591
Perfil 34: Precision=0.278, Recall=0.591
Perfil 35: Precision=0.278, Recall=0.591
Perfil 36: Precision=0.278, Recall=0.591
Perfil 37: Precision=0.282, Recall=0.802
Perfil 38: Precision=0.278, Recall=0.591
Perfil 39: Precision=0.278, Recall=0.591
Perfil 40: Precision=0.278, Recall=0.591
Perfil 41: Precision=0.282, Recall=0.802
Perfil 42: Precision=0.282, Recall=0.802
Perfil 43: Precision=0.278, Recall=0.591
Perfil 44: Precision=0.278, Recall=0.591
Perfil 45: Precision=0.282, Recall=0.802
Perfil 46: Precision=0.278, Recall=0.591
Perfil 47: Precision=0.278, Recall=0.591
Perfil 48: Precision=0.278, Recall=0.591
Perfil 49: Precision=0.282, Recall=0.802
Perfil 50: Precision=0.282, Recall=0.802

=== Métricas de evaluación global (promedio sobre perfiles aleatorios) ===
Precision promedio global: 0.279
Recall promedio global: 0.655</code></pre>
</section>
<section id="análisis-de-efectividad-de-las-recomendaciones" class="level3" data-number="2.1.5">
<h3 data-number="2.1.5" class="anchored" data-anchor-id="análisis-de-efectividad-de-las-recomendaciones"><span class="header-section-number">2.1.5</span> Análisis de efectividad de las recomendaciones</h3>
<p>El dataset utilizado no está muy probado y los datos a veces tienden a ser muy similares los unos a los otros a tal punto que al momento de recomendar nuevos destinos a usuarios ya en la base de datos esto podía causar resultados que no tenían mucho sentido. Por otro lado, la recomendación de destinos podría personalizarse aún más buscando un alpha adecuado dependiendo del usuario y que él determine a cual criterio le daría más importancia. - Usuarios con preferencias similares reciben recomendaciones alineadas.</p>
<ul>
<li><p>Se puede observar un sesgo positivo hacia destinos populares, lo que puede reflejar una mayor demanda.</p></li>
<li><p>Las rutas más recomendadas podrían recibir mayor tráfico si estas recomendaciones se aplican en producción. **</p></li>
</ul>


</section>
</div>
</section>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>